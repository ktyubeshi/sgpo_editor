# GUI コンポーネント仕様書

このドキュメントはSGPO Editorのすべてのグラフィカルユーザーインターフェース（GUI）要素の機能と期待される動作を詳細に記述しています。

## 目次

1. [メインウィンドウ](#メインウィンドウ)
2. [エントリエディタ](#エントリエディタ)
3. [検索ウィジェット](#検索ウィジェット)
4. [統計情報ウィジェット](#統計情報ウィジェット)
5. [テーブル](#テーブル)
6. [メニューとツールバー](#メニューとツールバー)
7. [ダイアログ](#ダイアログ)

## メインウィンドウ

### 概要
メインウィンドウはアプリケーションの中心的なコンテナで、すべてのウィジェットとコンポーネントがここに配置されます。

### 現在の実装
- ウィンドウタイトル: "PO Editor"
- デフォルトサイズ: 800 × 600ピクセル
- レイアウト: 中央にテーブル、上部に検索ウィジェット、上部ドックにエントリエディタ、右側ドックに統計情報ウィジェット
- ステータスバー: 操作の状態や情報を表示

### 期待される動作
- 起動時に適切なサイズでウィンドウを表示する
- ウィンドウサイズ変更時にすべてのコンポーネントが適切にリサイズされる
- ウィンドウ状態（サイズ、位置、ドックウィジェットの配置）を記憶し、次回起動時に復元する
- 複数のドックウィジェットを適切に管理し、ユーザーがそれらを再配置できるようにする
- アプリケーション終了時に変更が保存されていない場合、確認ダイアログを表示する

## エントリエディタ

### 概要
POファイルの翻訳エントリを編集するためのウィジェットです。msgctxt、msgid、msgstrの表示と編集、およびFuzzyフラグの設定が可能です。

### 現在の実装
- レイアウト: 
  - LAYOUT1: msgctxt上部、msgid/msgstr下部横並び（現在の標準レイアウト）
  - LAYOUT2: 左右分割レイアウト（代替レイアウト）
- コンポーネント:
  - msgctxt編集ボックス: コンテキスト情報（オプション）を表示・編集
  - msgid表示ボックス: 原文を表示（読み取り専用）
  - msgstr編集ボックス: 翻訳文を編集
  - Fuzzyチェックボックス: 翻訳が曖昧または要確認の場合にチェック
  - Applyボタン: 変更を適用

### 期待される動作
- エントリが選択されたとき、関連する情報を各フィールドに正確に表示する
- msgstr のテキスト編集時、自動的に変更を検出しウィジェット内の内部モデルを更新する
- Fuzzy チェックボックスの変更時、エントリの状態を更新する
- Apply ボタンクリック時、変更をPOファイルのデータモデルに確定的に適用する
- 異なるレイアウト間の切り替えをスムーズに行い、編集中のデータを保持する
- 複数行のテキストを適切に表示・編集できる
- テキスト変更通知を適切なタイミングで発行し、過度な処理を防ぐ

## 検索ウィジェット

### 概要
POファイル内のエントリを検索・フィルタリングするためのウィジェットです。

### 現在の実装
- コンポーネント:
  - 「POファイルを開く」ボタン: ファイル選択ダイアログを表示
  - フィルタリングコンボボックス: 「すべて」「翻訳済み」「未翻訳」「ファジー」から選択
  - 検索テキストボックス: キーワード入力フィールド →　要変更!!! 検索テキストボックス→フィルタキーワードボックスに変更する
  - クリアボタン: 検索条件をリセット →　要変更!!! フィルタ条件をリセット
- マッチモード: 「部分一致」固定

### 期待される動作
- フィルターの変更時、即座にテーブル表示を更新する
- 検索テキスト入力時、デバウンス処理（100ミリ秒）後に検索を実行し、テーブル表示を更新する
- 「クリア」ボタンクリック時、すべての検索条件をリセットしてテーブル表示を更新する
- 「POファイルを開く」ボタンクリック時、ファイル選択ダイアログを表示する
- 検索条件をSearchCriteriaオブジェクトとして提供する

## 統計情報ウィジェット

### 概要
現在開いているPOファイルの翻訳統計情報を表示するウィジェットです。

### 現在の実装
- 表示項目:
  - 全エントリ数: POファイル内の総エントリ数
  - 翻訳済み: 翻訳が完了しているエントリ数
  - 未翻訳: 翻訳が未完了のエントリ数
  - ファジー: 要確認としてマークされているエントリ数
  - 進捗率: 翻訳完了率（%）

### 期待される動作
- POファイルが開かれたとき、または変更があったときに統計情報を自動更新する
- 数値を正確に表示し、進捗率は小数点以下1桁まで表示する
- レイアウトがコンパクトで、ドックウィジェット内に適切に収まる

## テーブル

### 概要
POファイルのエントリ一覧を表示し、選択や操作を行うためのテーブルウィジェットです。

### 現在の実装
- 列構成:
  - エントリ番号: POファイル内の順序(POファイルで出現順の通し番号)
  - msgctxt: コンテキスト情報
  - msgid: 原文
  - msgstr: 翻訳文
  - 状態: 翻訳状態（未翻訳/翻訳済み/ファジー）
- 機能:
  - 列ヘッダークリックによるソート機能
  - 行選択によるエントリ編集の連携

### 期待される動作
- POファイルが開かれたとき、エントリをテーブルに表示する
- 検索やフィルター条件に基づいて表示を更新する
- 列ヘッダークリック時、その列でソートする（同じ列の場合は昇順/降順を切り替え）
- 行選択時、選択されたエントリをエントリエディタに表示する
- スクロールや表示のパフォーマンスが良好である
- 各列の幅が適切に調整され、内容が見やすい
- 列の幅はユーザが変更可能
- エントリの状態に応じて視覚的なインジケータ（色や記号）を表示する

## メニューとツールバー

### 概要
アプリケーションの機能にアクセスするためのメニュー項目とツールバーボタンです。

### 現在の実装
- ファイルメニュー:
  - 開く: POファイルを開く
  - 保存: 現在のPOファイルを保存
  - 名前を付けて保存: 現在のPOファイルを新しい名前で保存
  - 終了: アプリケーションを終了
- 表示メニュー:
  - レイアウト1: msgctxt上部、msgid/msgstr下部横並び
  - レイアウト2: 左右分割レイアウト

### 期待される動作
- メニュー項目選択時、対応する機能を実行する
- ファイル操作やレイアウト変更などの機能に簡単にアクセスできる
- ショートカットキーが設定されている場合、正しく機能する
- 現在の状態に応じてメニュー項目の有効/無効状態を適切に管理する

## ダイアログ

### 概要
特定の操作や確認のためのダイアログウィンドウです。

### 現在の実装
- ファイル選択ダイアログ: POファイルを開く/保存する際に使用
- 確認ダイアログ: 変更が保存されていない場合などに表示

### 期待される動作
- POファイルを開く際、適切なファイルフィルターでファイル選択ダイアログを表示する
- POファイルを保存する際、適切なファイル拡張子でファイル保存ダイアログを表示する
- 変更が保存されていない状態でアプリケーションを終了しようとした場合、確認ダイアログを表示する
- エラーや警告が発生した場合、適切なメッセージダイアログを表示する
